<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MPDyn &mdash; MDnotes  ドキュメント</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="Gnuplotでグラフ作成" href="../plot/Gnuplot_01.html" />
    <link rel="prev" title="LAMMPS" href="lammps.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MDnotes
            <img src="../_static/MDnoteslogo.jfif" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Simulation Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GROMACS/GROMACSinstall.html">GROMACSのインストール</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GROMACS/GROMACSindex1.html">GROMACSチュートリアル1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GROMACS/GROMACSindex2.html">GROMACSチュートリアル2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GROMACS/GROMACSmdp.html">GROMACS.mdpオプション</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VMD/VMDindex.html">VMDの使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GNUPLOT/GNUPLOTusage.html">gnuplotの使い方</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Molecular Dynamics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mdsoft.html">Molecular Dynamics Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="gromacs.html">Gromacs</a></li>
<li class="toctree-l1"><a class="reference internal" href="namd.html">Namd</a></li>
<li class="toctree-l1"><a class="reference internal" href="lammps.html">LAMMPS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MPDyn</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">インストール</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mpdyns-1">MPDynS(1コア)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gnu">Gnuコンパイラの場合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intel">Intelコンパイラを利用する場合</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mpi">MPI版(並列計算版)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dds4">dds4でのインストール例</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id2">計算</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">解析</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#md">MD計算</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analy"><code class="docutils literal notranslate"><span class="pre">./Analy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#crd">CRDファイル</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">手順</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#top-cg-prm">top_CG.prm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#par-cg-prm">par_CG.prm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-data">input.data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">解析完了</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id6">解析の種類</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rdf-rdfg">RDF / RDFG</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rz">RZ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scd">SCD（全原子限定）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#szz">SZZ（粗視化限定）</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plot/Gnuplot_01.html">Gnuplotでグラフ作成</a></li>
<li class="toctree-l1"><a class="reference internal" href="vmd.html">VMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="Discovery_studio.html">Discovery Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="fftw.html">FFTW</a></li>
<li class="toctree-l1"><a class="reference internal" href="plumed.html">PLUMED</a></li>
<li class="toctree-l1"><a class="reference internal" href="packmol.html">Packmol</a></li>
<li class="toctree-l1"><a class="reference internal" href="MPI.html">MPI environment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../slack/insto.html">slack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../device/main.html">Device in Lab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../make_homepages/how_to_use_git.html">How to edit this homepages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../make_homepages/sandbox.html">Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SPHINX/sphinxindex.html">Sphinxの使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GIT/gitindex.html">Gitの使い方</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cheat sheet</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GROMACS/GROMACScheat.html">GROMACSチートシート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VMD/VMDcheat.html">VMDチートシート</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Room</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python/matplotlib.html">matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/MDAnalysis.html">MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/MDAnalysis_tutorial.html">MDAnalysis tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/anaconda.html">Anaconda</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Polymer Group</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Polymer/polymer_property.html">高分子材料の物性値の調整</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MDnotes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>MPDyn</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mpdyn">
<h1>MPDyn<a class="headerlink" href="#mpdyn" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>篠田の個人的な汎用プログラムであり、粗視化モデルの開発などもこちらを用いて最初行っていた。並列化効率は高くないので一般的なMDには扱いがよくないが、新しいモデルの開発には扱いが非常に良い。膜系の解析ツールが充実しているため、現在では主にMDのトラジェクトリーの解析プログラムとして利用している。ソースコードはfortran90で書かれており、比較的解読が容易と思われる。</p>
<section id="id1">
<h2>インストール<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference external" href="http://www.chembio.nagoya-u.ac.jp/labhp/physchem1/member/wshinoda/MPDyn2/index.html">MPDynのダウンロードページ</a>からMPDynをダウンロードし、適当な場所で展開しておく。
また、バーションによっては<code class="docutils literal notranslate"><span class="pre">bin</span></code>ディレクトリが作成されない場合もあるので、その場合は手動で作成する。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/App
tar xvf MPDyn2.tar.gz
<span class="nb">cd</span> MPDyn2/
mkdir -p bin
<span class="nb">cd</span> <span class="nb">source</span>
</pre></div>
</div>
<section id="mpdyns-1">
<h3>MPDynS(1コア)<a class="headerlink" href="#mpdyns-1" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>基本的には、makeファイルを選んでmakeするだけでインストールできる。</p>
<p>gnuコンパイラ(gfortran)を利用する場合は<code class="docutils literal notranslate"><span class="pre">Makefile.gnu</span></code>を、intelコンパイラを利用する場合は<code class="docutils literal notranslate"><span class="pre">Makefile.intel</span></code>を利用しmakeする。</p>
<section id="gnu">
<h4>Gnuコンパイラの場合<a class="headerlink" href="#gnu" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make -f Makefile.gnu -j <span class="m">4</span>
make -f Makefile.gnu -j <span class="m">4</span> TOOL <span class="c1"># tool類の生成(CONV_CRDなど)</span>
</pre></div>
</div>
</section>
<section id="intel">
<h4>Intelコンパイラを利用する場合<a class="headerlink" href="#intel" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make -f Makefile.intel -j <span class="m">4</span>
make -f Makefile.intel -j <span class="m">4</span> TOOL <span class="c1"># tool類の生成(CONV_CRDなど)</span>
</pre></div>
</div>
<p>これで、<code class="docutils literal notranslate"><span class="pre">MPDyn2/bin/</span></code>の中に</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MPDynS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPDynS_MOLFILE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONV_PDB_CRD</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PSFCG</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GenCGconf</span></code></p></li>
</ul>
<p>が、生成される。パスを通しておこう。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vi ~/.bashrc <span class="c1">#.bashrcの編集</span>

<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>???????　と書いてある行の末尾に
:<span class="nv">$HOME</span>/App/MPDyn2/
を追加する。
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">~/.bashrc</span></code>して<code class="docutils literal notranslate"><span class="pre">MPDynS</span></code>と実行したときに</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fortran</span> <span class="n">runtime</span> <span class="n">error</span><span class="p">:</span> <span class="n">File</span> <span class="s1">&#39;input.data&#39;</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span>
<span class="n">At</span> <span class="n">line</span> <span class="mi">291</span> <span class="n">of</span> <span class="n">file</span> <span class="n">Read_Condition</span><span class="o">.</span><span class="n">f90</span> <span class="p">(</span><span class="n">unit</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;��=��&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>と表示されればインストールには成功している。</p>
</section>
</section>
<section id="mpi">
<h3>MPI版(並列計算版)<a class="headerlink" href="#mpi" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>先程の続きでも問題はない。</p>
<p>sourceディレクトリでmakeするときに、MPIの文字を追加する。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make -j <span class="m">4</span> -f Makefile.intel MPI
</pre></div>
</div>
<p>こうすることで、<code class="docutils literal notranslate"><span class="pre">./bin/MPDynP</span></code>が生成される。これはMPI計算に利用できる実行バイナリである。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>gnuコンパイラを利用しても並列版はコンパイルできるはずであるが、自分は何度試してもできなかった。(gnu-4.8.4, 4.9.4, 8.3.1で検証した。)</p>
</div>
<section id="dds4">
<h4>dds4でのインストール例<a class="headerlink" href="#dds4" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar xvf MPDyn.tar.gz
<span class="nb">cd</span> MPDyn
mkdir -p bin
<span class="nb">cd</span> <span class="nb">source</span>
mpi-selector-menu
<span class="c1"># set openmpi-2.0.2a1 as a current user default.</span>
<span class="c1"># If you set the default openmpi, please relogin the machine.</span>
module purge
module load openmpi/2.1.1-intel2017u4 intel/2017u4
make -j <span class="m">4</span> -f Makefile.intel
make -j <span class="m">4</span> -f Makefile.intel MPI
</pre></div>
</div>
</section>
</section>
</section>
<section id="id2">
<h2>計算<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>具体的なオプション等は公式ホームページを参考。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -np <span class="nv">$NSLOTS</span> MPDynP
</pre></div>
</div>
<p>などで並列計算ができると思う。</p>
</section>
<section id="id3">
<h2>解析<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>大まかな手順は以下の通りである。</p>
<ol class="simple">
<li><p>MD計算をし、トラジェクトリを書き出す(.xtcでも.dcdでもいい。)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./Analy</span></code>を作成</p></li>
<li><p>crdファイルを作る</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">top_CG.prm</span></code>に分子の情報を追加</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">par_CG.prm</span></code>にパラメーターを追加</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input.data</span></code>に解析方法を書く。</p></li>
</ol>
<section id="md">
<h3>MD計算<a class="headerlink" href="#md" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">NAMD</span></code>や<code class="docutils literal notranslate"><span class="pre">lammps</span></code>で計算する事が多いか。</p>
</section>
<section id="analy">
<h3><code class="docutils literal notranslate"><span class="pre">./Analy</span></code><a class="headerlink" href="#analy" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>MPDynで解析したアウトプットは<code class="docutils literal notranslate"><span class="pre">実行ディレクトリ/Analy</span></code>に保存されていくために先に<code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">Analy</span></code>しておこう。</p>
</section>
<section id="crd">
<h3>CRDファイル<a class="headerlink" href="#crd" title="このヘッドラインへのパーマリンク">¶</a></h3>
<section id="id4">
<h4>手順<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ol class="simple">
<li><p>トラジェクトリからpdb生成</p></li>
<li><p>分子ごとにソート</p></li>
<li><p>原子のインデックスを揃える</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONV_PDB_CRD</span></code>する</p></li>
</ol>
<p>MPDyn用の構造ファイルで、0フレーム目(何フレーム目でもいいが)の座標ファイル(pdb)を使って作ることが多い。</p>
<p>vmdでトラジェクトリを読み込んで、TKconsoleで</p>
<p><code class="docutils literal notranslate"><span class="pre">animate</span> <span class="pre">write</span> <span class="pre">pdb</span> <span class="pre">initial.pdb</span> <span class="pre">beg</span> <span class="pre">0</span> <span class="pre">end</span> <span class="pre">0</span></code></p>
<p>とすると、0フレーム目のinitial.pdbが生成される。</p>
<p>しかし、この生成されたpdbは分子種でソートされていないため、ソートする。</p>
<p>(ソート前)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ATOM</span>      <span class="mi">1</span>  <span class="mi">1</span><span class="n">N</span>   <span class="n">POPC</span>    <span class="mi">1</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">2</span>  <span class="mi">1</span><span class="n">P</span>   <span class="n">POPC</span>    <span class="mi">1</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">3</span>  <span class="n">N</span>    <span class="n">POPI</span>    <span class="mi">2</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">4</span>  <span class="n">P</span>    <span class="n">POPI</span>    <span class="mi">2</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">5</span>  <span class="mi">1</span><span class="n">N</span>   <span class="n">POPC</span>    <span class="mi">3</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">6</span>  <span class="mi">1</span><span class="n">P</span>   <span class="n">POPC</span>    <span class="mi">3</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
</pre></div>
</div>
<p>(ソート後:こうしたい)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ATOM</span>      <span class="mi">1</span>  <span class="mi">1</span><span class="n">N</span>   <span class="n">POPC</span>    <span class="mi">1</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">2</span>  <span class="mi">1</span><span class="n">P</span>   <span class="n">POPC</span>    <span class="mi">1</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">5</span>  <span class="mi">1</span><span class="n">N</span>   <span class="n">POPC</span>    <span class="mi">3</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">6</span>  <span class="mi">1</span><span class="n">P</span>   <span class="n">POPC</span>    <span class="mi">3</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">3</span>  <span class="n">N</span>    <span class="n">POPI</span>    <span class="mi">2</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
<span class="n">ATOM</span>      <span class="mi">4</span>  <span class="n">P</span>    <span class="n">POPI</span>    <span class="mi">2</span>      <span class="o">-</span><span class="mf">4.198</span>   <span class="mf">1.022</span>  <span class="mf">19.272</span>  <span class="mf">1.00</span>  <span class="mf">0.00</span>      <span class="n">MEMB</span>
</pre></div>
</div>
<p>これには<code class="docutils literal notranslate"><span class="pre">grep</span></code>と<code class="docutils literal notranslate"><span class="pre">&gt;(リダイレクト)</span></code>が便利である。</p>
<p>grepは特定のパターンを含む文字列を抽出するコマンドで、</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat initial.pdb <span class="p">|</span> grep POPC

ATOM      <span class="m">1</span>  1N   POPC    <span class="m">1</span>      -4.198   <span class="m">1</span>.022  <span class="m">19</span>.272  <span class="m">1</span>.00  <span class="m">0</span>.00      MEMB
ATOM      <span class="m">2</span>  1P   POPC    <span class="m">1</span>      -4.198   <span class="m">1</span>.022  <span class="m">19</span>.272  <span class="m">1</span>.00  <span class="m">0</span>.00      MEMB
ATOM      <span class="m">5</span>  1N   POPC    <span class="m">3</span>      -4.198   <span class="m">1</span>.022  <span class="m">19</span>.272  <span class="m">1</span>.00  <span class="m">0</span>.00      MEMB
ATOM      <span class="m">6</span>  1P   POPC    <span class="m">3</span>      -4.198   <span class="m">1</span>.022  <span class="m">19</span>.272  <span class="m">1</span>.00  <span class="m">0</span>.00      MEMB
</pre></div>
</div>
<p>と行にPOPCのみが含まれる行のみを抜き出すことができる。これをリダイレクトする(<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>)とファイルに書き込む事ができるので、</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat initial.pdb <span class="p">|</span> grep POPC &gt; ordered_initial.pdb
</pre></div>
</div>
<p>とすると<code class="docutils literal notranslate"><span class="pre">ordered_initial.pdb</span></code>に書き込まれる。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>注意点として、 <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> は上書き、 <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> はファイルがあれば書き足すと動作が違う。</p>
<p>２種類目の分子からは <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> を使う。</p>
</div>
<p>つまり、</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat initial.pdb <span class="p">|</span> grep POPC &gt; ordered_initial.pdb
cat initial.pdb <span class="p">|</span> grep POPI &gt;&gt; ordered_initial.pdb
cat initial.pdb <span class="p">|</span> grep TIP3 &gt;&gt; ordered_initial.pdb
...<span class="o">(</span>分子種の数だけ繰り返す<span class="o">)</span>
</pre></div>
</div>
<p>これで、分子ごとに並んだpdbファイルが生成された。</p>
<p>しかし、これだと原子番号が並んでいない。これはvmdで読み込んで書き出すことで修正できる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vmd</span> <span class="n">ordered_initial</span><span class="o">.</span><span class="n">pdb</span>

<span class="p">(</span><span class="n">TK</span> <span class="n">console</span><span class="p">)</span>
<span class="n">animate</span> <span class="n">write</span> <span class="n">pdb</span> <span class="n">mod</span><span class="o">.</span><span class="n">pdb</span>
</pre></div>
</div>
<p>これで<code class="docutils literal notranslate"><span class="pre">mod.pdb</span></code>は分子ごとに並び、かつインデックスも揃ったモノができている。</p>
<p>長くなったが、これでやっとcrdファイルが作れる。</p>
<p>これは<code class="docutils literal notranslate"><span class="pre">CONV_PDB_CRD</span></code>というコマンドで作れる。</p>
<p>対話形式でいろいろ質問される。</p>
<ul class="simple">
<li><p>Name of PDB file ?</p>
<ul>
<li><p>変換するpdbファイルの名前</p></li>
</ul>
</li>
<li><p>number of molecular species ?</p>
<ul>
<li><p>分子の種類が何個あるか（整数）</p></li>
</ul>
</li>
<li><p>name of molecules ? write all in one line with space inbetween</p>
<ul>
<li><p>分子の名前をスペース区切りで</p></li>
</ul>
</li>
<li><p>number of molecules ? write all in one line</p>
<ul>
<li><p>各分子の分子数。</p></li>
</ul>
</li>
<li><p>number of atoms per molecule ? write all in one line.</p>
<ul>
<li><p>１分子あたりの原子数。</p></li>
</ul>
</li>
</ul>
<p>これらに答えて行けばいい。</p>
<p>例）</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> Name of PDB file ?
mod.pdb
 number of molecular species ?
3
 name of molecules ? write all in one line with space inbetween
POPC POPI TIP3
 number of molecules ? write all in one line.
64 64 1707
 number of atoms per molecule ? write all in one line.
16 18 1
</pre></div>
</div>
<p>下3つの質問は先ほど並び変えた分子の順番通りにすること。</p>
</section>
</section>
<section id="top-cg-prm">
<h3>top_CG.prm<a class="headerlink" href="#top-cg-prm" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>分子のトポロジー（結合順序などを書く）</p>
<p>フォーマットは中を見てくれればわかると思うが、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt; POPC  ! palmitoyl oleyl PC
NUMATOM= 16
NUMBOND= 15
NUMIMPR= 0
ATOM       1      NC          NC        87.1647   +0.1118033989 0.0
ATOM       2      PH          PH        94.9716   -0.1118033989 0.0
ATOM       3      GL          GL        41.0725    0.00   0.0
ATOM       4      EST1        EST1      58.0358    0.00   0.0
ATOM       5      C11         CM        42.0804    0.00   0.0
ATOM       6      C12         CM        42.0804    0.00   0.0
ATOM       7      C13         CMD2      26.0378    0.00   0.0
ATOM       8      C14         CM        42.0804    0.00   0.0
ATOM       9      C15         CM        42.0804    0.00   0.0
ATOM      10      C16         CT2       29.0615    0.00   0.0
ATOM      11      EST2        EST2      58.0358    0.00   0.0
ATOM      12      C21         CM        42.0804    0.00   0.0
ATOM      13      C22         CM        42.0804    0.00   0.0
ATOM      14      C23         CM        42.0804    0.00   0.0
ATOM      15      C24         CM        42.0804    0.00   0.0
ATOM      16      C25         CT2       29.0615    0.00   0.0
BOND 1 2  2 3  3 4  4 5  5 6  6 7  7 8  8 9  9 10
BOND 3 11  11 12  12 13  13 14  14 15  15 16
&lt;&lt;
</pre></div>
</div>
<p>を分子ごとに追加する。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>解析で使う場合、bondやangleの情報は必要としないので、NUMBOND = 0とし、</p>
<p>BONDの記述をすべて消してもいい。（というか、下手にbond, angleを入れるとそのパラメーターが必要になりめんどくさい）</p>
</div>
<p>例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt; POPC  ! palmitoyl oleyl PC
NUMATOM= 16
NUMBOND= 0
NUMIMPR= 0
ATOM       1      NC          NC        87.1647   +0.1118033989 0.0
ATOM       2      PH          PH        94.9716   -0.1118033989 0.0
ATOM       3      GL          GL        41.0725    0.00   0.0
ATOM       4      EST1        EST1      58.0358    0.00   0.0
ATOM       5      C11         CM        42.0804    0.00   0.0
ATOM       6      C12         CM        42.0804    0.00   0.0
ATOM       7      C13         CMD2      26.0378    0.00   0.0
ATOM       8      C14         CM        42.0804    0.00   0.0
ATOM       9      C15         CM        42.0804    0.00   0.0
ATOM      10      C16         CT2       29.0615    0.00   0.0
ATOM      11      EST2        EST2      58.0358    0.00   0.0
ATOM      12      C21         CM        42.0804    0.00   0.0
ATOM      13      C22         CM        42.0804    0.00   0.0
ATOM      14      C23         CM        42.0804    0.00   0.0
ATOM      15      C24         CM        42.0804    0.00   0.0
ATOM      16      C25         CT2       29.0615    0.00   0.0
&lt;&lt;
</pre></div>
</div>
<p>としてもいい。</p>
</section>
<section id="par-cg-prm">
<h3>par_CG.prm<a class="headerlink" href="#par-cg-prm" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ここに、相互作用パラメーターを追加する必要がある。</p>
<p>上で書いたように、bondなどを追加しなければ必要なのはnonbond (lj)のパラメーターだけのはず。</p>
<p>フォーマットは</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">NONBOND</span>
<span class="n">UNIT</span><span class="o">=</span> <span class="n">kcal_per_mol</span> <span class="c1"># [ kcal_per_mol / K / kJ_per_mol</span>
<span class="c1"># water</span>
<span class="n">W</span>    <span class="n">W</span>    <span class="n">LJ12</span><span class="o">-</span><span class="mi">4</span>   <span class="mf">0.895</span>   <span class="mf">4.371</span>     <span class="mf">2.0</span>   <span class="mf">15.0</span>
<span class="c1"># Alkane</span>
<span class="n">CT</span>   <span class="n">CT</span>   <span class="n">LJ9</span><span class="o">-</span><span class="mi">6</span>    <span class="mf">0.469</span>   <span class="mf">4.585</span>     <span class="mf">2.0</span>   <span class="mf">15.0</span>
<span class="n">CT</span>   <span class="n">CM</span>   <span class="n">LJ9</span><span class="o">-</span><span class="mi">6</span>    <span class="mf">0.444</span>   <span class="mf">4.5455</span>    <span class="mf">2.0</span>   <span class="mf">15.0</span>
</pre></div>
</div>
<p>である。</p>
<p>これは系に含まれる原子の種類分必要である。</p>
<p>ex)</p>
<p>系にCT, CM, Wが含まれるなら、</p>
<p>CT-CT, CT-CM, CT-W, CM-CM, CM-W, W-Wの6個のパラメーターが必要。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>これも解析で使う場合、パラメーターの値は正しくなくていいため</p>
<p>CT   CT   LJ9-6    0.0   0.0     2.0   15.0</p>
<p>CT   CM   LJ9-6    0.0   0.0    2.0   15.0</p>
<p>というふうに追加するのが楽。</p>
</div>
</section>
<section id="input-data">
<h3>input.data<a class="headerlink" href="#input-data" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>やっと解析ができる。MPDynでの解析は解析をするディレクトリに<code class="docutils literal notranslate"><span class="pre">input.data</span></code>を作成し、そこにいろいろ書き込んでいく。</p>
<p>以下インプットの例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt; JOB_NAME
  SZZ
&lt;&lt;
&gt;&gt; STDOUT
  ON
&lt;&lt;
&gt;&gt; METHOD
  Analysis
&lt;&lt;
&gt;&gt; PBC
  RC=    60.
  RSKIN=  2.
  RRESPA= 6.
  RHEAL=  4.
  MAXPAIR= 40000000
  TBOOK=  8
  VDWSWITCH=  OFF
  VDWCORRECT= OFF
&lt;&lt;
&gt;&gt; STATUS
  Initial
  PDB= ON
&lt;&lt;
&gt;&gt; FORCEFIELD
 FF= CG
 PARFILE= &quot;par_CG.prm&quot;
 TOPFILE= &quot;top_CG.prm&quot;
# PARFILE= &quot;./new3.prm&quot;
# PARFILE=&quot;./par_c36_sm_chol.prm&quot;
# TOPFILE=&quot;./SDKparam/top_CG.prm&quot;
# PSF= &quot;./dmpc_autopsf.psf&quot;
&lt;&lt;
&gt;&gt; SYSTEM
  SYSMOL=4
  MOLNAME=POPC POPI TIP3 SOD
  MOLNUM=64 64 1707 64
  ATMNUM=16 18 1 1
&lt;&lt;
&gt;&gt; DATA_FORM_TRJ
  FORM=DCD
&lt;&lt;
&gt;&gt; ANALYZ_FILE
         1                ! number of files
./3_200ns.cg ! ## file name &amp; step number &amp; interval
         1000    1
&lt;&lt;
&gt;&gt; ANALYZ_NAME
  METHOD= SZZ
&lt;&lt;
&lt;end&gt;
</pre></div>
</div>
<p>基本的には<a class="reference external" href="http://simulo.apchem.nagoya-u.ac.jp/personal/wshinoda/MPDyn2/">JOB_SCRIPT</a>のページを参考にしてほしい。</p>
<p>どんな解析ができるかはANALYZ_NAMEを参照のこと。</p>
<p>ここでは、簡単にしか説明しない。言及のないものは上のexampleと同じにしておけばいい。</p>
<ul>
<li><p>JOB_NAME</p>
<ul class="simple">
<li><p>おそらく任意だが解析法を書くといいと思う</p></li>
</ul>
</li>
<li><p>METHOD</p>
<ul class="simple">
<li><p>解析をする場合はAnalysis</p></li>
</ul>
</li>
<li><p>STATUS</p>
<ul class="simple">
<li><p>Initial   PDB=ONにすると先ほど作ったinitial.crdを読みとってくれるみたいだ。</p></li>
</ul>
</li>
<li><p>FORCEFIELD</p>
<ul>
<li><p>FFは力場。粗視化ならCG、CHARMM36ならCHARMM</p></li>
<li><p>全原子の場合はPARFILEとPSFを指定する必要がある。PARFILEは計算に使ったパラメーターファイルでいいが複数指定ができないためあらかじめ1つのファイルにマージしておく必要がある。</p></li>
<li><p>粗視化の場合は PARFILE= &quot;par_CG.prm&quot;、TOPFILE= &quot;top_CG.prm&quot;と先ほど編集した2つのファイルを指定する。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>筆者の環境では何故か <code class="docutils literal notranslate"><span class="pre">~/CGparam/par_CG.prm</span></code> とか <code class="docutils literal notranslate"><span class="pre">/home/tanaka/CGparam/par_CG.prm</span></code> のようなパス付き指定ができず、毎回解析実行ディレクトリに2つのファイルを持ってくる必要があったが、これはシンボリックリンクを貼ることで誤魔化している。ただし、シンボリックリンクを削除すると元ファイルも消える恐れがある。取り扱い注意。</p>
<p>シンボリックリンクの貼り方 <code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">~/CGparam/par_CG.prm</span></code></p>
</div>
</li>
</ul>
</li>
<li><p>SYSTEM</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONV_PDB_CRD</span></code>した時のような系の情報が必要となる。</p></li>
</ul>
</li>
<li><p>DATA_FORM_TRJ</p>
<ul class="simple">
<li><p>トラジェクトリの形式を指定する。基本的にはDCDかXTCだろう。</p></li>
</ul>
</li>
<li><p>ANALYZ_FILE</p>
<ul class="simple">
<li><p>解析するトラジェクトリを指定する。
上から、解析するファイル数、解析ファイル名（拡張子は除く）、フレーム数とstride数である。
もし、トラジェクトリが複数になっている場合は</p></li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    &gt;&gt; ANALYZ_FILE
             6                ! number of files
    ./centering_pr100 ! ## file name &amp; step number &amp; interval
             10000    1
    ./centering_pr200 ! ## file name &amp; step number &amp; interval
             10000    1
    ./centering_pr300 ! ## file name &amp; step number &amp; interval
             10000    1
    ./centering_pr400 ! ## file name &amp; step number &amp; interval
             10000    1
    ./centering_pr500 ! ## file name &amp; step number &amp; interval
             10000    1
    ./centering_pr600 ! ## file name &amp; step number &amp; interval
             10000    1
    &lt;&lt;
</pre></div>
</div>
<p>のように記述する。</p>
<ul class="simple">
<li><p>ANALYZ_NAME</p>
<ul>
<li><p>解析方法を選択。ここでは粗視化脂質膜のオーダーパラメーターを解析するSZZを選択した。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id5">
<h3>解析完了<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>大体1回目は失敗するので出てきたエラーメッセージを元に修正していけばいい。</p>
</section>
</section>
<section id="id6">
<h2>解析の種類<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ここでは、筆者がよく使った解析について書いていく。とはいえ、usageは公式を見ればわかるので注意点を書いていこうと思う。</p>
<section id="rdf-rdfg">
<h3>RDF / RDFG<a class="headerlink" href="#rdf-rdfg" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>動径分布関数 / 重心の動径分布関数をもとめるメソッドである。NOINTRA= ONにすることで同分子内の原子をカウントしなくなるため、便利である。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>RC / GRID　が割り切れる値じゃないとMPDynがsegmentation faultする気がする。</p>
</div>
<p>膜などを扱うグループでは、2次元の動径分布関数が必要になる事が多いが、MPDynでは解析できない。</p>
<p>MDAnalysisを使おう！</p>
</section>
<section id="rz">
<h3>RZ<a class="headerlink" href="#rz" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>各原子の膜垂直軸に沿ってのプロフィールが計算できるメソッドである。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>RANGE / GRID　が割り切れる値じゃないとMPDynがsegmentation faultする気がする。</p>
</div>
</section>
<section id="scd">
<h3>SCD（全原子限定）<a class="headerlink" href="#scd" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>脂質分子のオーダーパラメーターが計算できる。混ぜものの脂質も可能。</p>
<p>対応脂質がDPPC/DPhPC/DMPC/TEPCとなるため、それ以外の脂質についてはソースコードを書き換える必要がある。</p>
</section>
<section id="szz">
<h3>SZZ（粗視化限定）<a class="headerlink" href="#szz" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>そもそも隠し解析コマンドなので気づかない。</p>
<p>粗視化MDにおいて脂質分子のオーダーパラメーターが計算できる。混ぜものの脂質も可能。</p>
<p>対応脂質が少ない。それ以外の脂質についてはソースコードを書き換える必要がある。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lammps.html" class="btn btn-neutral float-left" title="LAMMPS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../plot/Gnuplot_01.html" class="btn btn-neutral float-right" title="Gnuplotでグラフ作成" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, I.Kawabata, S.Harada, H.Tanaka.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>