<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gromacs &mdash; MDnotes  ドキュメント</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> MDnotes
            <img src="../../_static/MDnoteslogo.jfif" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Simulation Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GROMACS/GROMACSinstall.html">GROMACSのインストール</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GROMACS/GROMACSindex1.html">GROMACSチュートリアル1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GROMACS/GROMACSindex2.html">GROMACSチュートリアル2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GROMACS/GROMACSmdp.html">GROMACS.mdpオプション</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VMD/VMDindex.html">VMDの使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GNUPLOT/GNUPLOTusage.html">gnuplotの使い方</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Molecular Dynamics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MD/mdsoft.html">Molecular Dynamics Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/gromacs.html">Gromacs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/namd.html">Namd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/lammps.html">LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/mpdyn.html">MPDyn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/Gnuplot_01.html">Gnuplotでグラフ作成</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/vmd.html">VMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/Discovery_studio.html">Discovery Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/fftw.html">FFTW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/plumed.html">PLUMED</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/packmol.html">Packmol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MD/MPI.html">MPI environment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../slack/insto.html">slack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../device/main.html">Device in Lab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../make_homepages/how_to_use_git.html">How to edit this homepages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../make_homepages/sandbox.html">Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SPHINX/sphinxindex.html">Sphinxの使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GIT/gitindex.html">Gitの使い方</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cheat sheet</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GROMACS/GROMACScheat.html">GROMACSチートシート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VMD/VMDcheat.html">VMDチートシート</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Room</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../python/matplotlib.html">matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/MDAnalysis.html">MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/MDAnalysis_tutorial.html">MDAnalysis tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/anaconda.html">Anaconda</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Polymer Group</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Polymer/polymer_property.html">高分子材料の物性値の調整</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MDnotes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Gromacs</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gromacs">
<h1>Gromacs<a class="headerlink" href="#gromacs" title="このヘッドラインへのパーマリンク">¶</a></h1>
<section id="id1">
<h2>概要<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>GROMACS (Groningen Machine for Chemical Simulations)は、フリーウェアの分子動力学シミュレーションパッケージの一つである。オランダ・フローニンゲン大学で開発され、その後世界中の開発者によって更新され続けている。</p>
</section>
<section id="id2">
<h2>インストール方法<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference external" href="http://manual.gromacs.org/documentation/">Download GROMACS</a>にアクセスし、適当なバージョンの項目の「Download」をクリックし、&quot;Source code&quot; の項目からダウンロードする。</p>
<p>ダウンロードするファイル名は、gromacs-XXX.tar.gz のような名前になっているはず。&quot;XXX&quot;にはバージョンが入る。</p>
<hr class="docutils" />
<p>どのバージョンをダウンロードすればいいかわからないときは、とりあえず最新のものにしておけば良い。
自分の研究テーマの前任者とバージョンを合わせた方が良い場合もある。</p>
<hr class="docutils" />
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">## &quot;gromacs-XXX.tar.gz&quot;が、ディレクトリ&quot;~/App&quot;内にあるとします。</span>

<span class="nb">cd</span>  ~/App/
tar -xzvf gromacs-XXX.tar.gz
<span class="nb">cd</span>  ./gromacs-XXX/
</pre></div>
</div>
<p>上のようにコマンドを打つと、圧縮ファイルである&quot;gromacs-XXX.tar.gz&quot;を解凍して、新たに&quot;gromacs-XXX&quot;というディレクトリが作成されます。
(&quot;圧縮&quot;,&quot;解凍&quot;などが意味不明でキレそうな時は、<a class="reference external" href="https://wa3.i-3-i.info/word1477.html">参考ページ</a>を読んで落ち着いてください。)</p>
<p>この状態で<code class="docutils literal notranslate"><span class="pre">ls</span></code>コマンドを打つと、&quot;gromacs-XXX&quot;の中身が表示されます。
その中に、&quot;README&quot;や&quot;INSTALL&quot;のようなファイルがあり、それを読み、その指示通りにすればインストールができるはずです。
ただ、全て英語でわかりにくいと思うので、ここに日本語で書いておきます。</p>
<p>このまま、つまりディレクトリ&quot;gromacs-XXX&quot;にいる状態で、次のようにコマンドを打ってください。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir gmx_install
mkdir build
<span class="nb">cd</span> ./build
cmake ../ -DGMX_BUILD_OWN_FFTW<span class="o">=</span>ON -DREGRESSIONTEST_DOWNLOAD<span class="o">=</span>ON -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/App/gromacs-XXX/gmx_install
make -j4
make check
sudo make install
</pre></div>
</div>
<div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>.. note::

    スパコン等を使用してMPI並列計算をしたい場合は、 ``-DGMX_MPI=on`` のオプションを追加する必要がある。
</pre></div>
</div>
<p>&quot;cmake&quot;や&quot;make&quot;のコマンドではある程度時間がかかります。</p>
<p>ここまででエラーがでなければ、さらにVim等で&quot;~/.bashrc&quot;を開き(<code class="docutils literal notranslate"><span class="pre">vim</span> <span class="pre">~/.bashrc</span></code>),次のように書き加える。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>最後の行に

<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/App/gromacs-XXX/gmx_install/bin:<span class="si">${</span><span class="nv">PATH</span><span class="si">}</span>

を追加する。
</pre></div>
</div>
<p>確認のため、</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/.bashrc
gmx --version
</pre></div>
</div>
<p>と打ち、gromacsのバージョンが正しく表示されていれば、インストール完了です。</p>
<section id="gpu">
<h3>GPU版のインストール<a class="headerlink" href="#gpu" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>gromacsはGPUによる高速計算に対応している。グラフィックボードが刺さっているスパコンではこれを利用すると計算が早くなるため(できるなら)ばちこり利用しよう。</p>
<div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>
.. warning::

    数は少ないが、AMDのグラッフィックボード(RADEON)を使う場合、2018.8を使用することをおすすめする。

    これは2018.7までは力場の制御にバグがあることが修正されていなかった（近年になってようやく発見された）ことと、2019.1〜2019.4まではAMD製のGPUがうまく検出されず動作しないバグ、2020.1ではそれは直ったものの動作が非常に不安定になっていることがあるためです。
</pre></div>
</div>
<section id="tgpu7">
<h4>tgpu7の場合<a class="headerlink" href="#tgpu7" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>tgpu7のCUDAバージョンは8.0であるため、gromacs2018-8がインストールできる最新バージョンである。またデフォルトで入っているcmakeもバージョンが古いため、cmakeも新しいものをインストールする必要がある。
以下にcmakeのオプションを示す。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/home/tanaka/App/cmake-3.10.2/build/bin/cmake ../ <span class="se">\</span>
-DCMAKE_C_COMPILER<span class="o">=</span>/usr/local/gcc-4.9.4/build/bin/gcc <span class="se">\ </span>
-DCMAKE_CXX_COMPILER<span class="o">=</span>/usr/local/gcc-4.9.4/build/bin/g++ <span class="se">\ </span>
-DGMX_BUILD_OWN_FFTW<span class="o">=</span>on <span class="se">\</span>
-DGMX_SIMD<span class="o">=</span>AVX_256 <span class="se">\</span>
-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/home/tanaka/App/gromacs-2018.8/gmx_install/
</pre></div>
</div>
<p>とした。(cmake3.10.2は上記の場所にインストールした。)</p>
<div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>
.. warning::

    SIMD最適化に関して、gromacsは自動で利用できる最適化を探してくれるはずが、手動で指定する必要があった(`-DGMX_SIMD=AVX_256`)。このままインストールを続けると、このあとのmakeでfftwのビルドに失敗する。
    これを修正するためには、**cmake後にできる`build/src/contrib/fftw/CMakeFiles/fftwBuild.dir/build.make`のファイルの109行目から(`;--enable-avx2;--enable-avx512`)を消去する。**
</pre></div>
</div>
<div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>
.. warning::

    上記のfftwビルド失敗は、gromacs-5.1.5では発生せず、

    gromacs2020では、**cmake後にできる`src/external/build-fftw/CMakeFiles/fftwBuild.dir/build.make`のファイルから(`;--enable-avx2;--enable-avx512`)を消去する必要がある。** gromacs-2019とはファイルの場所が変わっているので注意。
</pre></div>
</div>
</section>
<section id="id3">
<h4>東大物性研の場合<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>GPU版gromacsのインストールでは、</p>
<ul class="simple">
<li><p>gromacs</p></li>
<li><p>C, C++コンパイラ(gnu)</p></li>
<li><p>CUDA</p></li>
<li><p>cmake</p></li>
<li><p>intelコンパイラ</p></li>
</ul>
<p>これらすべての依存関係を満たす必要がある。</p>
<p>田中が、gromacs2018-8を東大物性研にインストール成功したときのそれぞれのバージョンは、</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">module</th>
<th align="center">version</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">mpt</td>
<td align="center">2.16</td>
</tr>
<tr>
<td align="center">cuda</td>
<td align="center">8.0</td>
</tr>
<tr>
<td align="center">cmake</td>
<td align="center">3.10.2</td>
</tr>
<tr>
<td align="center">gnu</td>
<td align="center">4.9.4</td>
</tr>
<tr>
<td align="center">intel</td>
<td align="center">16.0.8.266</td>
</tr>
</tbody>
</table><p>で成功した。</p>
<p>実際にインストールするときは一度すべてのモジュールを消して、ロードしたほうがいいだろう。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module purge  <span class="c1"># moduleの初期化</span>
module load mpt/2.16
module load cuda/8.0
module load cmake/3.10.2
module load gnu/4.9.4
module load intel/16.0.8.266
</pre></div>
</div>
<p>あとは上と同様にインストールをすればいいが、cmakeのオプションは</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake ../ -DGMX_BUILD_OWN_FFTW<span class="o">=</span>on <span class="se">\</span>
-DREGRESSIONTEST_DOWNLOAD<span class="o">=</span>on <span class="se">\</span>
-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/App/gromacs-2018.8/gmx_install/ <span class="se">\</span>
-DGMX_MPI<span class="o">=</span>on <span class="se">\</span>
-DGMX_GPU<span class="o">=</span>on <span class="se">\</span>
-DCMAKE_C_COMPILER<span class="o">=</span>/home/app/gcc/4.9.4/bin/gcc <span class="se">\</span>
-DCMAKE_CXX_COMPILER<span class="o">=</span>/home/app/gcc/4.9.4/bin/g++
</pre></div>
</div>
<p>と、GPUを有効化(<code class="docutils literal notranslate"><span class="pre">-DGMX_GPU=on</span></code>)し、CとC++のコンパイラの場所を指定(<code class="docutils literal notranslate"><span class="pre">-DCMAKE_C_COMPILER=/home/app/gcc/4.9.4/bin/gcc</span> <span class="pre">\</span> <span class="pre">-DCMAKE_CXX_COMPILER=/home/app/gcc/4.9.4/bin/g++</span></code>)した。</p>
<p>ちなみに、<strong>ジョブスクリプトでもモジュールをロードする必要がある</strong>ため注意。
東大物性研ではジョブスクリプト中で<code class="docutils literal notranslate"><span class="pre">.</span> <span class="pre">/etc/profile.d/modules.sh</span> </code>の記述がないとmoduleコマンドが使えない。</p>
</section>
</section>
<section id="cg-spica-plumed">
<h3>CG(Spica)+plumed版<a class="headerlink" href="#cg-spica-plumed" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>粗視化の計算をgromacsで行う必要があり、またレプリカ交換のMDを行う必要があった。</p>
<p>レプリカ交換はPlumed[^1]というインターフェイスを介して実装されているため、そちらをインストールしてある必要がある。<a class="reference external" href="https://tanaty5828.github.io/sphinx/MD/plumed.html">このページ</a>を参考にすること。</p>
<section id="id4">
<h4>東大物性研の場合<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>plumedとgromacsはコンパイラのバージョンを揃える必要があるため、</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module purge  <span class="c1"># moduleの初期化</span>
module load mpt/2.16
module load cmake/3.10.2
module load gnu/4.9.4
module load intel/16.0.8.266
</pre></div>
</div>
<p>としておこう。(MD計算時も同じモジュールを読み込む必要がある。)</p>
</section>
<section id="plumed">
<h4>Plumedのパッチ処理<a class="headerlink" href="#plumed" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>.. note::

    また粗視化の計算をgromacsで行うにはgromacs- **5.1.4** or  gromacs- **5.1.5** が必要であり、このバージョンに対応しているplumedのバージョンは2.4である。

    つまり現状(2020/01/22)ではgromacs- **5.1.4** + plumed- **2.4.6** が動く組み合わせとなる。
</pre></div>
</div>
<p>Plumedをインストールしたら、</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar xvf gromacs-5.1.4
<span class="nb">cd</span> gromacs-5.1.4
plumed patch -p
</pre></div>
</div>
<p>とすると対話形式でソフトウェア、バージョンを聞かれるため適切なものを選ぶ。</p>
<p>もしスパコンでこの作業をする場合は、</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>plumed --no-mpi -p
</pre></div>
</div>
<p>としてplumed-patchを実行する必要があるかもしれない。</p>
</section>
<section id="bonded-cpp">
<h4><code class="docutils literal notranslate"><span class="pre">bonded.cpp</span></code>の置換<a class="headerlink" href="#bonded-cpp" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>粗視化の計算をgromacsで行う場合は、ソースコードを置き換える必要がある。</p>
<p><code class="docutils literal notranslate"><span class="pre">bonded.cpp</span></code>のファイルを<code class="docutils literal notranslate"><span class="pre">gromacs-5.1.4/src/gromacs/listed_forces/bonded.cpp</span></code>と置き換える。</p>
</section>
<section id="id5">
<h4>gromacsのコンパイル<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>上記と同じだが、</p>
<ul class="simple">
<li><p>cコンパイラの場所を指定し(<code class="docutils literal notranslate"><span class="pre">-DCMAKE_C_COMPILER=/home/app/gcc/4.9.4/bin/gcc</span> <span class="pre">-DCMAKE_CXX_COMPILER=/home/app/gcc/4.9.4/bin/g++</span></code>)</p></li>
<li><p>固定ライブラリを利用(<code class="docutils literal notranslate"><span class="pre">-DBUILD_SHARED_LIBS=OFF</span> <span class="pre">-DGMX_PREFER_STATIC_LIBS=ON</span></code>)</p></li>
</ul>
<p>すると上手くいく。</p>
<div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>.. note::

    粗視化ではテーブルポテンシャルを利用する影響でGPUは使用できない。

    このため、明示的にGPUをOFFにしてコンパイルするのがベスト。( `-DGMX_GPU=off` )
</pre></div>
</div>
<p>つまりまとめると、</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir gmx_install
mkdir build
<span class="nb">cd</span> ./build
cmake ../ -DGMX_BUILD_OWN_FFTW<span class="o">=</span>on -DREGRESSIONTEST_DOWNLOAD<span class="o">=</span>on -DCMAKE_INSTALL_PREFIX<span class="o">=</span>/home/k0386/k038615/App/gromacs-5.1.4/gmx_install/ -DGMX_MPI<span class="o">=</span>on -DGMX_GPU<span class="o">=</span>off -DCMAKE_C_COMPILER<span class="o">=</span>/home/app/gcc/4.9.4/bin/gcc -DCMAKE_CXX_COMPILER<span class="o">=</span>/home/app/gcc/4.9.4/bin/g++ -DBUILD_SHARED_LIBS<span class="o">=</span>OFF -DGMX_PREFER_STATIC_LIBS<span class="o">=</span>ON
make -j4
make check
sudo make install
</pre></div>
</div>
<p>となる。エラーがでなければ成功である。</p>
</section>
</section>
<section id="minimum-supported-compiler-versions">
<h3>Minimum supported compiler versions<a class="headerlink" href="#minimum-supported-compiler-versions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>各バージョンのGromacsをコンパイルするために必要なコンパイラーの(最小)バージョン</p>
<p>ただし、intelコンパイラを使用したとしてもあるバージョンのg++が必要なことがある(libstdc++を使用する)ため、注意が必要。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Gromacs version</th>
<th>CMAKE</th>
<th>GNU(gcc)</th>
<th>Intel(icc) + libstdc++</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>2021-rc1</td>
<td>3.13</td>
<td>7</td>
<td>19.1<br />libstdc++ 7.1</td>
<td></td>
</tr>
<tr>
<td>2020.5</td>
<td>3.9.6</td>
<td>5.1</td>
<td>17.0.1<br />libstdc++ 5.1</td>
<td>CentOS8</td>
</tr>
<tr>
<td>2019.6</td>
<td>3.4.3</td>
<td>4.8.1</td>
<td>17.0.1<br />libstdc++ 4.8.1</td>
<td></td>
</tr>
<tr>
<td>2018.8</td>
<td>3.4.3</td>
<td>4.8.1</td>
<td>15.0<br />libstdc++ 4.8.1</td>
<td></td>
</tr>
<tr>
<td>2016.6</td>
<td>2.8.8</td>
<td>4.6</td>
<td>14<br />libstdc++ 4.6.1</td>
<td>CentOS7</td>
</tr>
<tr>
<td>5.1.5</td>
<td>2.8.8</td>
<td>4.4? <br />(4.7↑ is better)</td>
<td>12?<br />libstdc++ 4.4</td>
<td>CentOS6</td>
</tr>
</tbody>
</table><p>また、GPU有効でコンパイルするためには、更にCUDAのバージョンを合わせる必要がある。CUDAは新しいものほど良いというわけではなく、丁度いいものを選ぶ必要がある。</p>
<div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>.. note::

   CentOS7のgcc系は4.8.xがデフォルトで入っているため、cmakeのバージョンを上げれば、2019.6をコンパイルすることも可能なはず。
</pre></div>
</div>
</section>
</section>
<section id="command-line-reference">
<h2>Command-line reference<a class="headerlink" href="#command-line-reference" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>gromacsの実行バイナリ<code class="docutils literal notranslate"><span class="pre">gmx</span></code>には様々な実行コマンドがあり、それぞれで必要なオプションが覚えられなかったのでここにまとめる。</p>
<section id="gmx-mdrun">
<h3><code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">mdrun</span></code><a class="headerlink" href="#gmx-mdrun" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>実際にMD計算を実行するコマンドである。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Options</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>-deffnm</code></td>
<td align="center">デフォルトのファイル名。[str]</td>
</tr>
<tr>
<td align="center"><code>-nb gpu</code></td>
<td align="center">GPUで計算する。<br />(GPU=onでのコンパイルが必要)</td>
</tr>
<tr>
<td align="center"><code>-v</code></td>
<td align="center">標準出力へログを出す。</td>
</tr>
</tbody>
</table><p>ex)<code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">mdrun</span> <span class="pre">-deffnm</span> <span class="pre">1_100ns</span></code></p>
</section>
<section id="gmx-grompp">
<h3><code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">grompp</span></code><a class="headerlink" href="#gmx-grompp" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>MDのインプットなどを一つのバイナリ(.tpr)としてまとめるコマンド。(the gromacs preprocessor)</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Options</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>-f</code></td>
<td align="center">MDのインプットを指定[.mdp]</td>
</tr>
<tr>
<td align="center"><code>-c</code></td>
<td align="center">作成した/前回の結果の構造ファイル[.gro]</td>
</tr>
<tr>
<td align="center"><code>-t</code></td>
<td align="center">MD計算を引き継ぐ場合[.cpt]</td>
</tr>
<tr>
<td align="center"><code>-p</code></td>
<td align="center">トポロジーファイル[.top]</td>
</tr>
<tr>
<td align="center"><code>-n</code></td>
<td align="center">インデックスファイル[.ndx]</td>
</tr>
<tr>
<td align="center"><code>-o</code></td>
<td align="center">アウトプットのtprファイル名[.tpr]</td>
</tr>
</tbody>
</table><p>ex) <code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">grompp</span> <span class="pre">-f</span> <span class="pre">DNA_npt.mdp</span> <span class="pre">-c</span> <span class="pre">1_npt_equil.gro</span> <span class="pre">-t</span> <span class="pre">1_npt_equil.cpt</span> <span class="pre">-p</span> <span class="pre">topol.top</span> <span class="pre">-n</span> <span class="pre">index.ndx</span> <span class="pre">-o</span> <span class="pre">2_100ns.tpr</span></code></p>
</section>
<section id="gmx-solvate">
<h3><code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">solvate</span></code><a class="headerlink" href="#gmx-solvate" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ol class="simple">
<li><p>周期境界の箱を作成し、(<code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">editconf</span></code>でもできる。)</p></li>
<li><p>系を水などで満たす。</p></li>
</ol>
<p>コマンドである。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Options</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>-cp</code></td>
<td align="center">水で満たす系(溶質)の構造ファイル[.gro]</td>
</tr>
<tr>
<td align="center"><code>-cs</code></td>
<td align="center">溶媒の構造ファイル<br />TIP3Pは3点モデルなのでspc216.groでOK[.gro]</td>
</tr>
<tr>
<td align="center"><code>-p</code></td>
<td align="center">トポロジーファイル[.top]</td>
</tr>
<tr>
<td align="center"><code>-box</code></td>
<td align="center">ボックスサイズ(nm) [real real real]</td>
</tr>
<tr>
<td align="center"><code>-o</code></td>
<td align="center">アウトプットのgroファイル名[.tpr]</td>
</tr>
</tbody>
</table><p>ex) <code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">solvate</span> <span class="pre">-cp</span> <span class="pre">1bna.aa.newbox.gro</span> <span class="pre">-cs</span> <span class="pre">tip3p.gro</span> <span class="pre">-o</span> <span class="pre">1bna.aa.solvate.gro</span> <span class="pre">-p</span> <span class="pre">topol.top</span></code></p>
</section>
<section id="gmx-genion">
<h3><code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">genion</span></code><a class="headerlink" href="#gmx-genion" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>系の水とイオンを交換し、指定した濃度にするコマンド。</p>
<p>実際は<code class="docutils literal notranslate"><span class="pre">ions.mdp</span></code>から<code class="docutils literal notranslate"><span class="pre">ions.tpr</span></code>を作成し、これを用いて<code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">genion</span></code>する。</p>
<div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>
:download:`ions.mdp &lt;./ions.mdp&gt;`
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Options</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>-s</code></td>
<td align="center">イオンを入れるインプット[.tpr]</td>
</tr>
<tr>
<td align="center"><code>-p</code></td>
<td align="center">トポロジーファイル[.top]</td>
</tr>
<tr>
<td align="center"><code>-pname</code></td>
<td align="center">陽イオンの名前[str]</td>
</tr>
<tr>
<td align="center"><code>-nname</code></td>
<td align="center">陰イオンの名前[str]</td>
</tr>
<tr>
<td align="center"><code>-neutral</code></td>
<td align="center">系が中性になるように<br />カウンターイオンを追加</td>
</tr>
<tr>
<td align="center"><code>-conc</code></td>
<td align="center">系の濃度(mol/liter)[real]</td>
</tr>
<tr>
<td align="center"><code>-o</code></td>
<td align="center">アウトプットのgroファイル名[.tpr]</td>
</tr>
</tbody>
</table><div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>
.. warning::
    カウンターイオン＋特定の濃度になるようにイオンを入れる場合は、

    neutralとconcの両方を指定する必要がある。
</pre></div>
</div>
<p>ex)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx grompp -f ions.mdp -c 1AKI_solv.gro -p topol.top -o ions.tpr
gmx genion -s ions.tpr -o 1AKI_solv_ions.gro -p topol.top -pname NA -nname CL -neutral
</pre></div>
</div>
</section>
<section id="gmx-pdb2gmx">
<h3><code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">pdb2gmx</span></code><a class="headerlink" href="#gmx-pdb2gmx" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>構造のpdbファイルをgroファイルに変換するコマンド</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Options</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>-f</code></td>
<td align="center">変換したいpdbファイル[.pdb]</td>
</tr>
<tr>
<td align="center"><code>-ff</code></td>
<td align="center">力場名[str]</td>
</tr>
<tr>
<td align="center"><code>-water</code></td>
<td align="center">水の名前[str]</td>
</tr>
<tr>
<td align="center"><code>-o</code></td>
<td align="center">アウトプットのgroファイル名[.tpr]</td>
</tr>
</tbody>
</table><div class="highlight-eval_rst notranslate"><div class="highlight"><pre><span></span>
.. note::
    使用できる力場は ``/gmx-install/share/gromacs/top/`` に[力場.ff]というディレクトリを追加すると使えるようになる。

    charmm36なども自分で追加する必要がある。（探すのが難しかった）
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">-ff</span></code>や<code class="docutils literal notranslate"><span class="pre">-water</span></code>は指定しなくても、その後対話形式で聞かれる。</p>
<p>ex) <code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">pdb2gmx</span> <span class="pre">-f</span> <span class="pre">1AKI_clean.pdb</span> <span class="pre">-o</span> <span class="pre">1AKI_processed.gro</span></code></p>
</section>
<section id="gmx-energy">
<h3><code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">energy</span></code><a class="headerlink" href="#gmx-energy" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>計算のアウトプットのedrファイル(バイナリ)をgnuplotなどで表示できるようにするコマンド。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Options</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>-f</code></td>
<td align="center">インプットのエネルギーファイル[.edr]</td>
</tr>
<tr>
<td align="center"><code>-xvg</code></td>
<td align="center">出力フォーマット(noneにするとデータのみが並ぶ)</td>
</tr>
<tr>
<td align="center"><code>-o</code></td>
<td align="center">アウトプットのxvgファイル名[.xvg]</td>
</tr>
</tbody>
</table><p>ex) <code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">energy</span> <span class="pre">-f</span> <span class="pre">1_npt_equil.edr</span> <span class="pre">-o</span> <span class="pre">1_npt_equil.cone</span> <span class="pre">-xvg</span> <span class="pre">none</span></code></p>
<p>コマンド実行後に出力する物理量を選択する。</p>
</section>
<section id="gmx-trjconv">
<h3><code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">trjconv</span></code><a class="headerlink" href="#gmx-trjconv" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>書き出されたトラジェクトリに様々な処理をするコマンド。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Options</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>-f</code></td>
<td align="center">インプットのトラジェクトリファイル[.trr]</td>
</tr>
<tr>
<td align="center"><code>-s</code></td>
<td align="center">初期構造ファイル[.gro, .tpr]<br />-pbc molを使用する場合は.tprが必須</td>
</tr>
<tr>
<td align="center"><code>-n</code></td>
<td align="center">インデックスファイル[.ndx]</td>
</tr>
<tr>
<td align="center"><code>-b</code></td>
<td align="center">読み込むファイルの開始時間(ps)</td>
</tr>
<tr>
<td align="center"><code>-e</code></td>
<td align="center">読み込むファイルの終了時間(ps)</td>
</tr>
<tr>
<td align="center"><code>-pbc</code></td>
<td align="center">周期境界の取り扱い<br />[mol, res, atom, nojump, cluster, whole]</td>
</tr>
<tr>
<td align="center"><code>-o</code></td>
<td align="center">アウトプットのファイル名[.gro, .trr]</td>
</tr>
</tbody>
</table><p><code class="docutils literal notranslate"><span class="pre">-o</span></code>では.groも.trrも指定できる。</p>
<p>コマンドの実行後にサブセットを指定できる。これにより、系から水を除いたトラジェクトリなどが書き出せる。</p>
<section id="pbc">
<h4>-pbc<a class="headerlink" href="#pbc" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>田中が色々試した結果、トラジェクトリの変換操作は、</p>
<ol class="simple">
<li><p>PBCによる途切れを全体的に修正する（whole）</p></li>
<li><p>さらにそのトラジェクトリをclusterごとに集める</p></li>
<li><p>続いてタンパク質（溶質）の重心の位置をセンタリングする</p></li>
<li><p>必要に応じて回転操作を行う</p></li>
</ol>
<p>の順に変換を行うと、最も普遍的に問題なく処理を行うことができるようだ。これらの変換操作を一度に行うことはできない様子。<code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">trjconv</span></code>によるトラジェクトリ変換にはリファレンス構造を必要とし、<code class="docutils literal notranslate"><span class="pre">gmx</span> <span class="pre">trjconv</span></code>の<code class="docutils literal notranslate"><span class="pre">-s</span></code>に続くオプションで指定する。通常<code class="docutils literal notranslate"><span class="pre">tpr</span></code>形式が最も都合が良い。このとき、<strong>途切れた状態で保存されている<code class="docutils literal notranslate"><span class="pre">tpr</span></code>形式を<code class="docutils literal notranslate"><span class="pre">-s</span></code>入力に使うと表示がおかしくなるので十分に注意する</strong>。したがって、<code class="docutils literal notranslate"><span class="pre">-s</span></code>に入れるリファレンス構造は、<u>トポロジーを作ってエネルギー最小化を始める前の<code class="docutils literal notranslate"><span class="pre">tpr</span></code>ファイル</u>が最も都合が良い。</p>
<p>ex)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx trjconv -f input.trr -o output1.trr -s minimize.tpr -n <span class="k">in</span>.ndx -pbc whole
gmx trjconv -f output1.trr -o output2.trr -s minimize.tpr -n <span class="k">in</span>.ndx -pbc cluster
gmx trjconv -f output2.trr -o output3.trr -s minimize.tpr -n <span class="k">in</span>.ndx -pbc mol -ur compact -center
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">-pbc</span> <span class="pre">cluster</span></code>するとクラスタリングしたいグループを選ばされる。各自溶質を選ぶといいだろう。</p>
</section>
</section>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[^1]: Bonomi, M. et al. PLUMED: A portable plugin for free-energy calculations with molecular dynamics. Comput. Phys. Commun. 180, 1961–1972 (2009).</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, S.Yoshida, I.Kawabata, S.Harada, H.Tanaka.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>